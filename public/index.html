<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NutriLab</title>
    <link rel="icon" href="./assets/2.png" type="image/x-icon">
    <link rel="stylesheet" href="./css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=League+Spartan:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>


</head>

<body onload="obterDadosGrafico(); obterDadosKpi()">

    <div class="navbar">

        <div class="logonavbar">
            <img src="./assets/2.png" alt=""> <span>NutriLab</span>
        </div>

        <div class="itens">
            <a href="#sobrescroll"><span>Sobre</span></a>
            <a href="#calcscroll"><span>Calculadoras</span></a>
        </div>

        <div class="botoes">

            <div class="botao1">
                <button onclick="cadastrar()">
                    <a href="./cadastro.html"><span>Cadastre-se</span></a>
                </button>
            </div>

            <div class="botao2">
                <button onclick="login()">
                    <a href="./login.html"><span>Login</span></a>
                </button>
            </div>

        </div>

    </div>

    <div class="banner">

        <div class="textos">

            <div class="slogan">

                <span>

                    Seu futuro <br>
                    começa no <br>
                    que você <br>
                    come hoje. <br>

                </span>

            </div>

            <div class="mensagem">

                <span>Conheça o site</span>

            </div>

        </div>

        <div class="imagemBanner">

            <img src="./assets/2.png" alt="">

        </div>

    </div>

    <div class="alinhar">

        <div class="introducao">

            <h1>Introdução</h1>

            <span style="text-align: justify;">
                Uma boa alimentação traz inúmeros benefícios para o corpo e a mente. Ela fornece os nutrientes
                essenciais que nosso organismo precisa para funcionar de maneira eficiente, ajudando a melhorar a
                energia, o humor e a concentração no dia a dia. Uma dieta equilibrada também fortalece o sistema
                imunológico, prevenindo doenças e promovendo a longevidade. Além disso, uma alimentação saudável
                contribui para o controle do peso, melhora a saúde cardiovascular e reduz o risco de condições como
                diabetes e hipertensão. Investir em uma nutrição adequada é um passo essencial para alcançar mais
                disposição, bem-estar e qualidade de vida.
            </span>

        </div>

        <div class="pesquisa" id="div_pesquisa">
            <div style="height: 700px;" class="calc">
                <h1>Resultados da pesquisa</h1>
                <span class="descpesquisa" style="text-align: justify;">
                    Ao se cadastrar no site, o usuário é convidado a responder uma pesquisa,
                    com o objetivo de promover a conscientização entre os visitantes. A seguir, apresentamos os
                    resultados
                    obtidos.
                </span>
                <div class="div_pesquisa">
                    <div class="kpis" style="width: 100%; text-align: center;">
                        <div class="consciencia">
                            <span>Consciência Corporal (%) </span><br> <br>
                            <span class="numerokpipesquisa" style="font-size: 40px;" id="porc_consciencia">12</span> %
                        </div>
                        <div class="atividade">
                            <span>Atividade Física (%) </span><br> <br>
                            <span class="numerokpipesquisa" style="font-size: 40px;" id="porc_atividade">12</span> %
                        </div>
                        <div class="alimentacao">
                            <span>Alimentação Saudável (%) </span><br> <br>
                            <span class="numerokpipesquisa" style="font-size: 40px;" id="porc_alimentacao">12</span> %
                        </div>
                        <div class="totalusuarios">
                            <span>Total de respostas:</span> <br> <br>
                            <span class="numerokpipesquisa" style="font-size: 40px;" id="total_usuarios">12</span>
                        </div>
                    </div>
                    <div class="graficopesquisa" style="height: 57vh; width: 57vw">
                        <canvas id="myChartCanvas"></canvas>
                    </div>
                </div>
            </div>
        </div>


        <div class="calc" id="calcscroll">

            <h1>Calculadoras</h1>

            <span style="text-align: justify;">
                Existem algumas calculadoras que são úteis para calcular métricas nutricionais importantes para
                o seu desenvolvimento e consciência corporal, são bem simples e de fácil entendimento, veja abaixo
                as possíveis de serem realizadas: (É recomendado que todas sejam feitas) <br>
                As calculadoras nutricionais desempenham um papel importante para quem busca uma alimentação equilibrada
                e otimizada para suas necessidades de saúde e bem-estar. Elas fornecem uma maneira simples e eficaz de
                monitorar a ingestão de nutrientes e calorias, ajudando a ajustar a alimentação de acordo com metas
                específicas. <br> <br>

                <h1 style="font-size: 30px; text-align: center;">Efetue o Login no site para utilizar as calculadoras
                </h1>
            </span>

        </div>

        <div class="container">

            <div class="imgCalc">

                <img src="./assets/imc-removebg-preview.png" alt="">
                <h1>Índice de Massa Corporal (IMC)</h1>

            </div>

            <div class="descCalc">

                <span style="text-align: justify;">O IMC (Índice de Massa Corporal) é uma medida usada para avaliar se
                    uma pessoa está dentro de um
                    peso
                    considerado saudável em relação à sua altura. Ele é calculado dividindo o peso (em quilogramas) pela
                    altura (em metros) ao quadrado. Embora o IMC seja amplamente utilizado, ele não leva em consideração
                    a
                    composição corporal, como a proporção entre gordura e músculo, nem fatores como idade, sexo ou nível
                    de
                    atividade física.</span>

            </div>

        </div>


        <div class="container">

            <div class="descCalc">

                <span style="text-align: justify;">A Taxa Metabólica Basal (TMB) é a quantidade de energia (calorias)
                    que o corpo precisa para realizar suas
                    funções básicas enquanto está em repouso. Essas funções incluem respiração, circulação sanguínea,
                    regulação
                    da temperatura corporal, funcionamento dos órgãos e manutenção das células. Em outras palavras, a
                    TMB
                    representa a quantidade mínima de calorias que o corpo gasta para se manter vivo e funcional, sem
                    incluir
                    atividades físicas ou digestão de alimentos.</span>

            </div>

            <div class="imgCalc">

                <img src="./assets/tmb.png" alt="" style="width: 40%;">
                <h1>Taxa Matabólica Basal (TMB)</h1>

            </div>


        </div>

        <div class="container">

            <div class="imgCalc">

                <img src="./assets/inngestao.png" alt="" style="width: 50%;">
                <h1>Ingestão Hídrica</h1>

            </div>

            <div class="descCalc">

                <span style="text-align: justify;">Uma ingestão hídrica adequada é fundamental para o corpo e traz
                    inúmeras vantagens para o bom funcionamento do organismo. A água desempenha papéis essenciais nos
                    processos biológicos, regulando a temperatura corporal, facilitando o transporte de nutrientes, e
                    promovendo a circulação sanguínea. Ela também auxilia na digestão e no processo de absorção de
                    vitaminas e minerais, que são fundamentais para a saúde.</span>

            </div>

        </div>

        <div class="sobre" id="sobrescroll">

            <div class="descricaosobre">

                <img src="./assets/minhafoto.jpeg" alt="">

                <h1>João Gabriel</h1>
                <span>Aluno de CCO</span>

            </div>

            <div class="title">

                <h1> Olá! </h1>

                <span>Minhas redes sociais:</span>

                <div class="redes">

                    <a href="https://www.linkedin.com/in/jo%C3%A3o-gabriel-carvalho-ribeiro-37b47125a/"> <button> <img
                                src="./assets/linkedin.png" alt=""> Linkedin </button> </a>
                    <a href="https://github.com/joaogcr"> <button> <img src="./assets/github.png" alt=""> GitHub
                        </button> </a>

                </div>

                <div class="descricaosobremim">

                    <span>Meu nome é João Gabriel, tenho 19 anos e sou estudante de Ciência da Computação na São Paulo
                        Tech School (SPTech). Minha paixão por tecnologia começou cedo: formado como Técnico em
                        Mecatrônica, tive meus primeiros contatos com programação e logo me interessei profundamente
                        pela área, levando-me a buscar um Bacharelado no segmento.

                        Além disso, sempre me interessei por nutrição, especialmente após adotar hábitos mais saudáveis
                        ao perceber a importância de uma boa alimentação. Os resultados positivos dessa mudança me
                        encantaram e despertaram um profundo interesse por essa área tão valiosa. Esse site reflete
                        minha dedicação em unir tecnologia e bem-estar.</span>

                </div>

            </div>

        </div>

        <div class="footer">

            <img src="./assets/2.png" alt="" style="width: 100px;">
            <span> © 2024 NutriLab All Rights Reserved </span>

        </div>
    </div>


</body>

</html>

<script>

    function obterDadosGrafico() {

        fetch(`http://localhost:3333/index/ultimas/${sessionStorage.ID_USUARIO}`).then(function (response) {
            if (response.ok) {
                response.json().then(function (resposta) {
                    console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
                    resposta.reverse();

                    plotarGrafico(resposta);

                });
            } else {
                console.error('Nenhum dado encontrado ou erro na API');

            }
        })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
            });
    }

    function plotarGrafico(resposta) {

        console.log('iniciando plotagem do gráfico...');

        // Criando estrutura para plotar gráfico - labels
        let labels = [];
        let simData = [];
        let naoData = [];

        // Criando estrutura para plotar gráfico - dados
        let dados = {
            labels: labels,
            datasets: [{
                label: 'Sim',
                data: simData,
                fill: false,
                backgroundColor: "#519758",
                borderColor: "#519758",
                tension: 0.1
            },
            {
                label: 'Não',
                data: naoData,
                fill: false,
                backgroundColor: "grey",
                borderColor: "grey",
                tension: 0.1
            }]
        };

        console.log('----------------------------------------------')
        console.log('Estes dados foram recebidos pela funcao "obterDadosGrafico" e passados para "plotarGrafico":')
        console.log(resposta)

        // Inserindo valores recebidos em estrutura para plotar o gráfico
        for (i = 0; i < resposta.length; i++) {
            var registro = resposta[i];
            labels.push(registro.categoria);
            simData.push(registro.sim);
            naoData.push(registro.nao);
        }

        console.log('----------------------------------------------')
        console.log('O gráfico será plotado com os respectivos valores:')
        console.log('Labels:')
        console.log(labels)
        console.log('Dados:')
        console.log(dados.datasets)
        console.log('----------------------------------------------')

        const maxY = parseInt(Math.max(...dados.datasets[0].data) + 10);

        // Criando estrutura para plotar gráfico - config
        const config = {
            type: 'bar',
            data: dados,
            options: {
                scales: {
                    y: {
                        min: 0,
                        max: maxY
                    },
                },
            },
        };

        // Adicionando gráfico criado em div na tela
        let myChart = new Chart(
            document.getElementById(`myChartCanvas`),
            config
        );

        setTimeout(() => atualizarGrafico(dados, myChart), 2000);
    }

    // Esta função *atualizarGrafico* atualiza o gráfico que foi renderizado na página,
    // buscando a última medida inserida em tabela contendo as capturas, 

    //     Se quiser alterar a busca, ajuste as regras de negócio em src/controllers
    //     Para ajustar o "select", ajuste o comando sql em src/models
    function atualizarGrafico(dados, myChart) {

        fetch(`/index/tempo-real/${idUsuario}`, { cache: 'no-store' }).then(function (response) {
            if (response.ok) {
                response.json().then(function (novoRegistro) {

                    obterDadosGrafico(idUsuario);
                    // alertar(novoRegistro, idUsuario);
                    console.log(`Dados recebidos: ${JSON.stringify(novoRegistro)}`);
                    console.log(`Dados atuais do gráfico:`);
                    console.log(dados);

                    let avisoCaptura = document.getElementById(`avisoCaptura${idUsuario}`)
                    avisoCaptura.innerHTML = ""


                    if (novoRegistro[0].momento_grafico == dados.labels[dados.labels.length - 1]) {
                        console.log("---------------------------------------------------------------")
                        console.log("Como não há dados novos para captura, o gráfico não atualizará.")
                        avisoCaptura.innerHTML = "<i class='fa-solid fa-triangle-exclamation'></i> Foi trazido o dado mais atual capturado pelo sensor. <br> Como não há dados novos a exibir, o gráfico não atualizará."
                        console.log("Horário do novo dado capturado:")
                        console.log(novoRegistro[0].momento_grafico)
                        console.log("Horário do último dado capturado:")
                        console.log(dados.labels[dados.labels.length - 1])
                        console.log("---------------------------------------------------------------")
                    } else {
                        // tirando e colocando valores no gráfico
                        dados.labels.shift(); // apagar o primeiro
                        dados.labels.push(novoRegistro[0].momento_grafico); // incluir um novo momento

                        dados.datasets[0].data.shift();  // apagar o primeiro de umidade
                        dados.datasets[0].data.push(novoRegistro[0].peso); // incluir uma nova medida de umidade

                        myChart.update();
                    }

                    // Altere aqui o valor em ms se quiser que o gráfico atualize mais rápido ou mais devagar
                    proximaAtualizacao = setTimeout(() => atualizarGrafico(idUsuario, dados, myChart), 2000);
                });
            } else {
                console.error('Nenhum dado encontrado ou erro na API');
                // Altere aqui o valor em ms se quiser que o gráfico atualize mais rápido ou mais devagar
                proximaAtualizacao = setTimeout(() => atualizarGrafico(idUsuario, dados, myChart), 2000);
            }
        })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
            });

    }

    function obterDadosKpi() {

        fetch(`http://localhost:3333/kpis/dadoskpi7/${sessionStorage.ID_USUARIO}`).then(function (response) {
            if (response.ok) {
                response.json().then(function (resposta) {
                    console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
                    resposta.reverse();
                    porc_consciencia.innerHTML = `${resposta[0].proporcao}`
                });
            } else {
                console.error('Nenhum dado encontrado ou erro na API');
            }
        })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados p/ kpi: ${error.message}`);
            });

        fetch(`http://localhost:3333/kpis/dadoskpi8/${sessionStorage.ID_USUARIO}`).then(function (response) {
            if (response.ok) {
                response.json().then(function (resposta) {
                    console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
                    resposta.reverse();
                    porc_atividade.innerHTML = `${resposta[0].proporcao}`
                });
            } else {
                console.error('Nenhum dado encontrado ou erro na API');
            }
        })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados p/ kpi: ${error.message}`);
            });

        fetch(`http://localhost:3333/kpis/dadoskpi9/${sessionStorage.ID_USUARIO}`).then(function (response) {
            if (response.ok) {
                response.json().then(function (resposta) {
                    console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
                    resposta.reverse();
                    porc_alimentacao.innerHTML = `${resposta[0].proporcao}`

                });
            } else {
                console.error('Nenhum dado encontrado ou erro na API');
            }
        })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados p/ kpi: ${error.message}`);
            });

        fetch(`http://localhost:3333/kpis/dadoskpi10/${sessionStorage.ID_USUARIO}`).then(function (response) {
            if (response.ok) {
                response.json().then(function (resposta) {
                    console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
                    resposta.reverse();
                    total_usuarios.innerHTML = `${resposta[0].total_usuarios}`
                });
            } else {
                console.error('Nenhum dado encontrado ou erro na API');
            }
        })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados p/ kpi: ${error.message}`);
            });
    }
</script>